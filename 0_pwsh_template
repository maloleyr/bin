<#
.SYNOPSIS
    Generic PowerShell script template.

.DESCRIPTION
    This template contains:
      - "WhatIf" Support [$PSCmdlet.ShouldProcess]
      - Logging
      - Administrator check

.PARAMETER WhatIf
    If set, actions are logged but not executed.
#>

[CmdletBinding()]

param (
    # PUT PARAMETER DEFINITIONS HERE AND DELETE THIS COMMENT.
    #[switch]$DryRun
)

# FUNCTIONS
function Write-Ok { Write-Host "[OK]  $args" -ForegroundColor Green }
function Write-Warn { Write-Host "[WARN] $args" -ForegroundColor Yellow }

function Check-Administrator {
    if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
        Write-Warn "This script must be run as Administrator."
        return $false
    }
    else {
        Write-Ok "Running as Administrator."
        return $true
    }
}

# END FUNCTIONS

# LOGGING
$InformationPreference = 'Continue'
$timestamp = Get-Date -Format 'yyyyMMdd-HHmmss'
$lastRunLogFilePath = "$PSCommandPath.$timestamp.log"

# DO STUFF
try {
    if (-not $Global:Transcribing) {
        Start-Transcript -Path $lastRunLogFilePath -Append
    }

    $startTime = Get-Date
    Write-Information "Starting script at '$($startTime.ToString('u'))'."

    # BEGIN MAIN SCRIPT
    ##### PUT STUFF HERE TO DO STUFF #####
    # END MAIN SCRIPT

    $finishTime = Get-Date
    $elapsedTime = $finishTime - $startTime
    Write-Information "Finished script at '$($finishTime.ToString('u'))'. Took '$elapsedTime' to run."
}

finally {
    if ($Global:Transcribing) {
        Stop-Transcript
    }
}
