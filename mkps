#!/usr/bin/env bash
set -e
set -u
set -o pipefail

# A utility to create Powershell files with sane default.
# Credit: Evan Hahn [https://codeberg.org/EvanHahn]

if [ ! $# -eq 1 ]; then
  echo 'mkps takes one argument' 1>&2
  exit 1
elif [ -e "$1" ]; then
  echo "$1 already exists" 1>&2
  exit 1
fi

echo '<#
.SYNOPSIS
    Short description of what this script does.

.DESCRIPTION
    Longer description of purpose, behavior, and constraints.

.NOTES
    Author: 
    Project: 
    Phase: 
    Requires: Administrator (Yes/No)
    Idempotent: Yes / Mostly / No
#>

#region Strict Mode & Error Handling
Set-StrictMode -Version Latest
$ErrorActionPreference = 'Stop'
#endregion

#region Parameters
[CmdletBinding(SupportsShouldProcess = $true)]
param (
    [switch]$DryRun
)
#endregion

#region Helper Functions

function Write-Info {
    param ([string]$Message)
    Write-Host "[*] $Message"
}

function Write-Ok {
    param ([string]$Message)
    Write-Host "[+] $Message"
}

function Write-Warn {
    param ([string]$Message)
    Write-Warning $Message
}

function Write-Fail {
    param ([string]$Message)
    Write-Error $Message
}

#endregion

#region Preflight Checks

function Assert-Admin {
    if (-not ([Security.Principal.WindowsPrincipal] `
        [Security.Principal.WindowsIdentity]::GetCurrent()
        ).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {

        Write-Fail "This script must be run as Administrator."
        exit 1
    }
}

Assert-Admin
#endregion

#region Main Logic

try {
    Write-Info "Starting script: $($MyInvocation.MyCommand.Name)"

    if ($DryRun) {
        Write-Warn "DryRun mode enabled â€” no changes will be made."
    }

    # === SCRIPT BODY STARTS HERE ===
    # Example:
    # if ($PSCmdlet.ShouldProcess("Firewall", "Disable inbound rules")) {
    #     ...
    # }
    # === SCRIPT BODY ENDS HERE ===

    Write-Ok "Script completed successfully."
    exit 0
}
catch {
    Write-Fail "Script failed: $($_.Exception.Message)"
    exit 1
}

#endregion


' > "$1"

chmod u+x "$1"

"$EDITOR" "$1"
